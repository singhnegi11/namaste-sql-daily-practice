---self join

A self join is a SQL join where a table is joined with itself. It’s used when you need to compare rows within the same table or represent relationships inside one table (like hierarchy or duplicates).

select e1.emp_name,e1.salary,e1.joining_date,e2.salary as manager_salary , e2.joining_date as manager_joining_date from employee e1 join employee e2 on e1.manager_id =e2.emp_id 
where e1.salary> e2.salary and e1.joining_date>e2.joining_date order by e1.emp_name;


----ntile function 

The NTILE() function is a window (analytic) function in SQL that is used to divide an ordered result set into a specified number of roughly equal groups (buckets) and assign each row a bucket number.
It’s commonly used for ranking, segmentation, and percentile-style analysis.

with cte as (select *,ntile(3) over (order by avg_rating desc) as tier from driver_ratings)
select ct.driver_id,ct.avg_rating,
       case when tier = 1 then 'Top' 
	        when tier = 2 then 'Middle' 
			when tier = 3 then 'Bottom' end as performance_tier from cte ct


---how to add union all for adding extra row with different type in the end of column 

with cte as (select location_id,product_id,
(inventory_level-inventory_target ) as excess_insufficient_qty from inventory),
cte2 as (select location_id,sum(excess_insufficient_qty) as excess_insufficient_qty,
sum((excess_insufficient_qty*unit_cost)) as excess_insufficient_value from cte ct
inner join products p on ct.product_id =p.product_id
group by location_id)

select cast(location_id as varchar(50)) as location_id,excess_insufficient_qty,excess_insufficient_value from cte2 
union all
select 'Overall' as location_id,
sum(excess_insufficient_qty) as excess_insufficient_qty,
sum(excess_insufficient_value) as excess_insufficient_value from cte2;
